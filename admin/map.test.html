<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ㄴ주소 검색 및 마커 표시</title>
    <style>
        #map { width: 100%; height: 500px; }
    </style>
    <!-- 브이월드 맵 API 불러오기 -->
    <script type="text/javascript" src="https://map.vworld.kr/js/vworldMapInit.js.do?apiKey=56E398AA-1CA6-39E1-B90B-997708F6A41C"></script>
</head>
<body>
    <input type="text" id="address" placeholder="주소를 입력하세요">
    <button onclick="searchAddress()">검색</button>
    <div id="map"></div>
    <script>
        // 지도 초기화
        var apiMap;
        var mControl;
        var tempMarker = null;

        vworld.init("map", "map-first", 
            function() {        
                apiMap = this.vmap; // 브이월드맵 apiMap에 셋팅 
                apiMap.setBaseLayer(apiMap.vworldBaseMap); // 기본맵 설정 
                apiMap.setControlsType({"simpleMap":true}); // 간단한 화면
                apiMap.addVWORLDControl("zoomBar"); // panzoombar 등록
                apiMap.setCenterAndZoom(126.9784, 37.5665, 9); // 서울 시청을 중심으로 초기화
            },
            function (obj) { // 3D initCall(성공)
                // 3D 플러그인 초기화
            },
            function (msg) { // 3D failCall(실패)
                alert(msg);
            }
        );

        // 주소 검색 함수
        function searchAddress() {
            var address = document.getElementById('address').value;
            if (!address) {
                alert('주소를 입력하세요.');
                return;
            }

            // 브이월드 지오코딩 API 요청
            var xhr = new XMLHttpRequest();
            var url = 'https://api.vworld.kr/req/address?service=address&request=getCoord&version=2.0&crs=epsg:4326&address='
                + encodeURIComponent(address) + '&refine=true&simple=false&format=json&type=road&key=56E398AA-1CA6-39E1-B90B-997708F6A41C';
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var result = JSON.parse(xhr.responseText);
                    if (result.response.status === 'OK') {
                        var point = result.response.result.point;
                        var coord = [parseFloat(point.x), parseFloat(point.y)];

                        // 지도 중심 이동
                        apiMap.setCenterAndZoom(coord[0], coord[1], 16);

                        // 기존 마커 제거
                        if (tempMarker) {
                            apiMap.removeMarker(tempMarker);
                        }

                        // 새로운 마커 추가
                        var marker = new vworld.Marker(coord[0], coord[1], "검색된 위치", "");
                        marker.setIconImage(""); // 마커 아이콘 이미지 파일명 설정
                        marker.setZindex(3);
                        apiMap.addMarker(marker);
                        tempMarker = marker;
                    } else {
                        alert('주소를 찾을 수 없습니다.');
                    }
                }
            };
            xhr.send();
        }
    </script>
</body>
</html>
